{% extends "layout.html" %}
{% load i18n static %}

{% block breadcrumb %}
  <li><a href="{% url 'partnerships:partnerships_list' %}" id="lnk_partnerships">{% trans 'partnerships' %}</a></li>
  <li><a href="{% url 'partnerships:partners:list' %}" id="lnk_partners">{% trans 'partners' %}</a></li>
  <li class="active">{{ partner }}</li>
{% endblock %}

{% block style %}
  <link rel="stylesheet" href="{% static "partnerships/partnerships.css" %}">
{% endblock %}

{% block script %}
  <script src="{% static "partnerships/detail.js" %}"></script>
{% endblock %}

{% block content %}
<div class="page-header">
  <h1>{{ partner }}</h1>
</div>

<div class="panel panel-default">
  <div class="panel-body">
    <div class="row">
      <div class="col-sm-12">
        <p><em>{% blocktrans with created=partner.created|date:"SHORT_DATE_FORMAT" author=partner.author modified=partner.modified|date:"SHORT_DATE_FORMAT" %}created_{{ created }}_by_{{ author }}_modified_{{ modified }}{% endblocktrans %}</em></p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <dl class="dl-horizontal">
          <dt>{% trans "partner_type" %}</dt>
          <dd>{{ partner.partner_type }}</dd>

          <dt>{% trans "partner_code" %}</dt>
          <dd>{{ partner.partner_code }}</dd>

          <dt>{% trans "pic_code" %}</dt>
          <dd>{{ partner.pic_code }}</dd>

          <dt>{% trans "erasmus_code" %}</dt>
          <dd>{{ partner.erasmus_code }}</dd>

          {% if partner.is_ies %}<dd>{% trans "is_ies" %}</dd>{% endif %}

          {% if partner.now_known_as %}
          <dt>{% trans "now_known_as" %}</dt>
          <dd>{{ partner.now_known_as }}</dd>
          {% endif %}

          <dt>{% trans "is_nonprofit" %}</dt>
          <dd>{% if partner.is_nonprofit %}{% trans "yes" %}{% else %}{% trans "no" %}{% endif %}</dd>

          <dt>{% trans "is_public" %}</dt>
          <dd>{% if partner.is_public %}{% trans "yes" %}{% else %}{% trans "no" %}{% endif %}</dd>

          <dt>{% trans "contact_type" %}</dt>
          <dd>{{ partner.contact_type }}</dd>

          <dt>{% trans "use_egracons" %}</dt>
          <dd>{% if partner.use_egracons %}{% trans "yes" %}{% else %}{% trans "no" %}{% endif %}</dd>
        </dl>
      </div>
      <div class="col-sm-12 col-md-6">
        <dl class="dl-horizontal">
          <dt>{% trans "is_valid" %}</dt>
          <dd>{% if partner.is_valid %}{% trans "yes" %}{% else %}{% trans "no" %}{% endif %}</dd>

          <dt>{% trans "is_actif" %}</dt>
          <dd>{% if partner.is_actif %}{% trans "yes" %}{% else %}{% trans "no" %}{% endif %}</dd>

          <dt>{% trans "contact_address" %}</dt>
          <dd>{{ partner.address }}</dd>

          <dt>{% trans "website" %}</dt>
          <dd>{% if partner.website %}<a href="{{ partner.website }}" target="_blank">{{ partner.website }}</a>{% endif %}</dd>

          <dt>{% trans "email" %}</dt>
          <dd>{% if partner.email %}<a href="mailto:{{ partner.email }}">{{ partner.email }}</a>{% endif %}</dd>

          <dt>{% trans "phone" %}</dt>
          <dd>{{ partner.phone }}</dd>
        </dl>

        <p><em>{{ partner.comment }}</em></p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
        <h2>{% trans "associated_tags" %}</h2>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
        <ul class="tags-list">
        {% for tag in partner.tags.all %}
          <li>{{ tag }}</li>
        {% endfor %}
        </ul>
      </div>
    </div>

    {% if can_update_partner %}
    <div class="row">
      <div class="col-sm-12">
        <a href="{% url "partnerships:partners:update" partner.id %}" class="btn btn-default pull-right">{% trans "update_partner" %}</a>
      </div>
    </div>
    {% endif %}

    <hr>

    <div class="row">
      <div class="col-sm-12">
        <h2>{% trans "medias" %}</h2>
      </div>
    </div>
    <div class="row">
      {% for media in partner.medias.all %}
      <div class="col-sm-12 col-md-6">
        <div class="row">
          <div class="col-sm-9">
            <strong>{{ media.name }}</strong> <em>{{ media.get_visibility.display }}</em>
          </div>
          <div class="col-sm-3">
            {% if media.url %}
              {% trans "external_link" %}
            {% else %}
              {{ media.get_document_file_type }}/{{ media.get_document_file_size|filesizeformat }}
            {% endif %}
          </div>
        </div>
        <div class="row">
          <div class="col-sm-9">
            <p>{{ media.description }}</p>
          </div>
          <div class="col-sm-3">
            {% if can_update_partner %}
            <a href="{% url "partnerships:partners:medias:update" partner.id media.id %}" class="btn btn-default modal-link" data-modal="modal-media-update"><i class="fa fa-pencil fa-fw"></i></a>
            {% endif %}
            {% if media.url %}
            <a href="{{ media.url }}" class="btn btn-default" target="_blank"><i class="fa fa-eye fa-fw"></i></a>
            {% else %}
            <a href="{{ media.document_file.file.url }}" class="btn btn-default" target="_blank"><i class="fa fa-eye fa-fw"></i></a>
            {% endif %}
          </div>
        </div>
      </div>
      {% empty %}
      <div class="col-sm-12">{% trans "no_media_yet" %}</div>
      {% endfor %}
    </div>
    {% if can_update_partner %}
    <div class="row">
      <div class="col-sm-12">
        <a href="{% url "partnerships:partners:medias:create" partner.id %}" id="add-media" class="btn btn-default pull-right modal-link" data-modal="modal-media-create">{% trans "add_media" %}</a>
      </div>
    </div>
    {% endif %}

    <hr>

    <div class="row">
      <div class="col-sm-12">
        <h2>{% trans "entities" %}</h2>
      </div>
    </div>

    {% for entity in partner.entities.all %}
    <div class="partner-entity">
      <div class="row">
        <div class="col-sm-12 col-md-6">
          <h3 id="partner-entity-{{ entity.id }}">
            {{ entity }}
            <a href="{% url "partnerships:partners:entities:update" partner.id entity.id %}" class="btn btn-default modal-link" data-modal="modal-entity-update">
              <i class="fa fa-pencil fa-fw"></i>
            </a>
          </h3>

        </div>

        <div class="col-sm-12 col-md-6">
          <p><em>{% blocktrans with created=entity.created|date:"SHORT_DATE_FORMAT" author=entity.author modified=entity.modified|date:"SHORT_DATE_FORMAT" %}created_{{ created }}_by_{{ author }}_modified_{{ modified }}{% endblocktrans %}</em></p>
        </div>
      </div>

      <div class="row">
        {% if entity.contact_in %}
        <div class="col-sm-12 col-md-6">
          {% trans "contact_mobility_in" %}
          {% include "partnerships/includes/contact.html" with contact=entity.contact_in %}
        </div>
        {% endif %}
        <div class="col-sm-12 col-md-6">
          {% if entity.address %}
          <strong>{% trans "contact_address" %}</strong> {{ entity.address.one_line_display }}
          {% endif %}

          <p><em>{{ entity.comment }}</em></p>
        </div>
      </div>

      <div class="row">
        {% if entity.contact_out %}
        <div class="col-sm-12 col-md-6">
          {% trans "contact_mobility_out" %}
          {% include "partnerships/includes/contact.html" with contact=entity.contact_out %}
        </div>
        {% endif %}

        {% if entity.parent %}
        <div class="col-sm-12 col-md-6">
        {% trans "parent_entity" %}<br>
        <strong>{{ entity.parent }}</strong> <a href="{{ entity.parent.get_absolute_url }}" class="btn btn-default"><i class="fa fa-fw fa-eye"></i></a>
        </div>
        {% endif %}
      </div>
    </div>
    {% endfor %}

    {% if can_add_entities %}
    <div class="row">
      <div class="col-sm-12">
        <a href="{% url "partnerships:partners:entities:create" partner.id %}" class="btn btn-default pull-right modal-link" data-modal="modal-entity-create">{% trans "add_partner" %}</a>
      </div>
    </div>
    {% endif %}

  </div>
</div>

<div class="modal fade" id="modal-media-create" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <form action="{% url "partnerships:partners:medias:create" partner.id %}" method="post" class="partner-form" enctype="multipart/form-data">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="{% trans "close" %}"><span aria-hidden="true"><i class="fa fa-times"></i></span></button>
          <h4 class="modal-title" id="myModalLabel">{% trans "new_media" %}</h4>
        </div>
        <div class="modal-body">
          <i class="fa fa-circle-o-notch fa-spin fa-fw fa-5x"></i>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">{% trans "close" %}</button>
          <button type="submit" class="btn btn-primary">{% trans "new_media" %}</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="modal-media-update" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <form action="{% url "partnerships:partners:medias:update" partner.id 0 %}" method="post" class="partner-form" enctype="multipart/form-data">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="{% trans "close" %}"><span aria-hidden="true"><i class="fa fa-times"></i></span></button>
          <h4 class="modal-title" id="myModalLabel">{% trans "new_media" %}</h4>
        </div>
        <div class="modal-body">
          <i class="fa fa-circle-o-notch fa-spin fa-fw fa-5x"></i>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">{% trans "close" %}</button>
          <button type="submit" class="btn btn-primary">{% trans "update_media" %}</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
