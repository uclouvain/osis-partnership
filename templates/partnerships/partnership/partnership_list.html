{% extends "layout.html" %}

{% load bootstrap3 i18n static %}

{% block breadcrumb %}
  <li class="active">{% trans 'partnerships' %}</li>
{% endblock %}

{% block style %}
  <link rel="stylesheet" href="{% static "partnerships/partnerships.css" %}">
{% endblock %}

{% block script %}
  {% if not is_agreements %}
    {% url "partnerships:list" as url %}
  {% else %}
    {% url "partnerships:agreements-list" as url %}
  {% endif %}

  <script src="{% static "js/osis_datatable.js" %}"></script>
  <script src="{% static "partnerships/list.js" %}"></script>
  <script>
      initDataTable('partnershipIds', '{{ url }}', [
        { name: 'partner', data: 'partner', targets: 0 },
        { name: 'country', data: 'country', targets: 1 },
        { name: 'city', data: 'city', targets: 2 },
        { data: 'supervisor', targets: 3, orderable: false },
        { name: 'ucl',  data: 'entities_acronyms', targets: 4 },
        {% if not is_agreements %}
        { data: 'validity_end', targets: 5, orderable: false },
        {% else %}
        { data: 'academic_years', targets: 5, orderable: false },
        { data: 'status', targets: 6, orderable: false },
        {% endif %}
        {
          data: 'url',
          targets: {% if not is_agreements %}6{% else %}7{% endif %},
          orderable: false,
          render: renderLink('<i class="fas fa-eye"></i>', 'btn btn-default'),
        },
      ]);
  </script>
{% endblock %}

{% block content %}
  <div class="page-header">
    <h1>
      {% trans 'partnerships' %}
    </h1>
  </div>

  <div class="panel panel-default">
    <div class="panel-body">
      <div class="well">
        <div class="row">
          <div class="col-sm-12">
            <div class="pull-right">
              {% if can_change_configuration %}
              <a class="btn btn-default" type="button"
                 href="{% url "partnerships:configuration_update" %}">
                <i class="fas fa-fw fa-cog"></i> <span class="hidden-xs">{% trans "change_configuration" %}</span>
              </a>
              {% endif %}
              {% if can_add_partnership %}
              <a class="btn btn-default" type="button"
                 href="{% url "partnerships:ucl_management_entities:list" %}">
                <i class="fas fa-fw fa-cog"></i> <span class="hidden-xs">{% trans "ucl_management_entities" %}</span>
              </a>
              <a class="btn btn-default" type="button"
                 href="{% url "partnerships:create" %}">
                <i class="fas fa-fw fa-plus"></i> <span class="hidden-xs">{% trans "add_partnership" %}</span>
              </a>
            {% endif %}
              <button class="btn btn-default" type="button"
                      data-toggle="collapse" data-target="#partnership-filters"
                      aria-expanded="false" aria-controls="partnership-filters">
                <i class="fas fa-filter"></i> <span class="hidden-xs">{% if can_search_agreements %}{% trans "search_partnership_or_agreement" %}{% else %}{% trans "search_partnership" %}{% endif %}</span>
              </button>
            </div>
          </div>
        </div>

        <div class="collapse" id="partnership-filters">
          <div class="row">
            <ul class="nav nav-tabs" role="tablist">
              <li role="presentation" class="active"><a href="#filter-ucl" aria-controls="filter-ucl" role="tab" data-toggle="tab">{% trans 'ucl' %}</a></li>
              <li role="presentation"><a href="#filter-partner" aria-controls="filter-profile" role="tab" data-toggle="tab">{% trans 'partner' %}</a></li>
              <li role="presentation"><a href="#filter-partnership" aria-controls="filter-messages" role="tab" data-toggle="tab">{% trans 'partnership' %}</a></li>
            </ul>

            {% with form=filter.form %}
            <form action="" id="filter-form" method="get" autocomplete="off">
              <div class="tab-content">
                <div role="tabpanel" class="tab-pane fade in active" id="filter-ucl">
                  <div class="row">
                    <div class="col-sm-12 col-md-6">
                      {% bootstrap_field form.ucl_university %}
                    </div>
                    <div class="col-sm-12 col-md-6">
                      {% bootstrap_field form.ucl_university_labo %}
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-12 col-md-4">
                      {% bootstrap_field form.education_level %}
                    </div>
                    <div class="col-sm-12 col-md-4">
                      {% bootstrap_field form.years_entity %}
                    </div>
                    <div class="col-sm-12 col-md-4">
                      {% bootstrap_field form.university_offer %}
                    </div>
                  </div>
                </div>
                <div role="tabpanel" class="tab-pane fade" id="filter-partner">
                  <div class="row">
                    <div class="col-sm-12 col-md-6">
                      {% bootstrap_field form.partner %}
                    </div>
                    <div class="col-sm-12 col-md-6">
                      {% bootstrap_field form.partner_entity %}
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-12 col-md-4">
                      {% bootstrap_field form.partner_type %}
                    </div>
                    <div class="col-sm-12 col-md-4">
                      {% bootstrap_field form.erasmus_code %}
                    </div>
                    <div class="col-sm-12 col-md-4">
                      {% bootstrap_field form.use_egracons %}
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-12 col-md-4">
                      {% bootstrap_field form.city %}
                    </div>
                    <div class="col-sm-12 col-md-4">
                      {% bootstrap_field form.country %}
                    </div>
                    <div class="col-sm-12 col-md-4">
                      {% bootstrap_field form.continent %}
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-12">
                      {% bootstrap_field form.partner_tags %}
                    </div>
                  </div>
                </div>
                <div role="tabpanel" class="tab-pane fade" id="filter-partnership">
                  <div class="row">
                    <div class="col-sm-12 col-md-6">
{#                      {% bootstrap_field form.partnership_type %}#}
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-12 col-md-6">
                      {% bootstrap_field form.education_field %}
                    </div>
                    <div class="col-sm-12 col-md-6">
                      {% bootstrap_field form.supervisor %}
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-12 col-md-3">
                      {% bootstrap_field form.is_sms %}
                    </div>
                    <div class="col-sm-12 col-md-3">
                      {% bootstrap_field form.is_smp %}
                    </div>
                    <div class="col-sm-12 col-md-3">
                      {% bootstrap_field form.is_sta %}
                    </div>
                    <div class="col-sm-12 col-md-3">
                      {% bootstrap_field form.is_stt %}
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-12 col-md-3">
                      <label class="control-label" for="{{ form.partnership_in.id_for_label  }}">
                        {{ form.partnership_in.label }}
                        <i class="fas fa-info-circle" data-toggle="tooltip" data-placement="top" title="{{ form.partnership_in.help_text }}"></i>
                      </label>
                      {% bootstrap_field form.partnership_in show_label=False show_help=False %}
                    </div>
                    <div class="col-sm-12 col-md-3">
                      <label class="control-label" for="{{ form.partnership_ending_in.id_for_label  }}">
                        {{ form.partnership_ending_in.label }}
                        <i class="fas fa-info-circle" data-toggle="tooltip" data-placement="top" title="{{ form.partnership_ending_in.help_text }}"></i>
                      </label>
                      {% bootstrap_field form.partnership_ending_in show_label=False show_help=False %}
                    </div>
                    <div class="col-sm-12 col-md-3">
                      {% bootstrap_field form.partnership_valid_in %}
                    </div>
                    <div class="col-sm-12 col-md-3">
                      {% bootstrap_field form.partnership_not_valid_in %}
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-12 col-md-3">
                      <label class="control-label" for="{{ form.partnership_with_no_agreements_in.id_for_label  }}">
                        {{ form.partnership_with_no_agreements_in.label }}
                        <i class="fas fa-info-circle" data-toggle="tooltip" data-placement="top" title="{{ form.partnership_with_no_agreements_in.help_text }}"></i>
                      </label>
                      {% bootstrap_field form.partnership_with_no_agreements_in show_label=False show_help=False %}
                    </div>
                    <div class="col-sm-12 col-md-3">
                      {% bootstrap_field form.tags %}
                    </div>
                    <div class="col-sm-12 col-md-6">
                      {% bootstrap_field form.comment %}
                    </div>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-12">
                  <div class="pull-right">
                    <button type="reset" class="btn btn-default">{% trans "reset_search_fields" %}</button>
                    <button type="submit" class="submit-button btn btn-primary" name="search_partnership" value="search_partnership">{% trans "search_partnership" %}</button>
                    {% if can_search_agreements %}<button type="submit" class="submit-button btn btn-primary" name="search_agreement" value="search_agreement">{% trans "search_agreement" %}</button>{% endif %}
                  </div>
                </div>
              </div>
            </form>
            {{ form.media }}
            {% endwith %}
          </div>
        </div>
      </div>
      <div id="results">
        <div class="table-responsive">
          <table class="table table-stripped table-hover" id="result-list">
            <thead>
            <tr>
              {% if is_agreements %}
                <td>{% trans "partner" %}</td>
                <td>{% trans "country" %}</td>
                <td>{% trans "city" %}</td>
                <td>{% trans "partnership_supervisor" %}</td>
                <td>{% trans "ucl" %}</td>
                <td>{% trans "academic_years" %}</td>
                <td>{% trans "status" %}</td>
              {% else %}
                <td>{% trans "partner" %}</td>
                <td>{% trans "country" %}</td>
                <td>{% trans "city" %}</td>
                <td>{% trans "partnership_supervisor" %}</td>
                <td>{% trans "ucl" %}</td>
                <td>{% trans "validity_end" %}</td>
              {% endif %}
              <td></td>
            </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
          <div class="pull-right">
            {% if is_agreements %}
              <a
                  href="{% url "partnerships:export_agreements" %}"
                  data-base-href="{% url "partnerships:export_agreements" %}"
                  class="btn btn-default btn-export pull-right no_spinner"
              >
                {% trans "agreements_export" %}
              </a>
            {% else %}
              <a
                  href="{% url "partnerships:export" %}"
                  data-base-href="{% url "partnerships:export" %}"
                  class="btn btn-default btn-export no_spinner pull-right"
              >
                {% trans "partnerships_export" %}
              </a>
            {% endif %}
          </div>
        </div>
      </div>
  </div>
  <script rel="stylesheet" src="{% static 'partnerships/reset_form.js' %}" type="text/javascript"></script>
{% endblock %}
